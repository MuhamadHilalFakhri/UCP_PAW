
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<div class="container mt-5">
    <h1 class="text-center">Product List</h1>


    <form id="addProductForm" class="my-4">
        <div class="input-group">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">Add Product</button>
        </div>
    </form>
    <div id="productList" class="row row-cols-1 row-cols-md-3 g-4">
    </div>
    <div id="addProductModal" class="modal fade" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductModalLabel">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addProductFormModal">
                        <div class="form-group">
                            <label for="newProductName">Product Name</label>
                            <input type="text" id="newProductName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newProductDescription">Description</label>
                            <input type="text" id="newProductDescription" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newProductPrice">Price</label>
                            <input type="text" id="newProductPrice" class="form-control" required>
                        </div>

                        
                        <div id="fileInputContainer" style="display:none;">
                            <label for="newProductImage">Image</label>
                            <input type="file" id="newProductImage" name="image" class="form-control" accept="image/*" />
                        </div>

                        <button type="submit" class="btn btn-primary mt-3">Add Product</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    
    <div id="editModal" class="modal fade" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editProductForm">
                        <div class="form-group">
                            <label for="editProductName">Product Name</label>
                            <input type="text" id="editProductName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="editProductDescription">Description</label>
                            <input type="text" id="editProductDescription" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="editProductPrice">Price</label>
                            <input type="text" id="editProductPrice" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="editProductImage">Image</label>
                            <input type="file" id="editProductImage" name="image" class="form-control" accept="image/*" />
                            <img id="currentProductImage" src="" alt="Current Product Image" width="100" height="100" class="mt-2" />
                        </div>                        
                        <button type="submit" class="btn btn-primary mt-3">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="footer">
    <div class="container text-center">
        <p>&copy; 2024 Product App. All Rights Reserved.</p>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let produk = [];
    const addProductForm = document.getElementById('addProductForm');
    const productListContainer = document.getElementById('productList');
    const addProductModal = new bootstrap.Modal(document.getElementById('addProductModal'));
    const fileInputContainer = document.getElementById('fileInputContainer');
    const addProductFormModal = document.getElementById('addProductFormModal');
    const editModal = new bootstrap.Modal(document.getElementById('editModal'));
    const editProductForm = document.getElementById('editProductForm');
    const editProductNameInput = document.getElementById('editProductName');
    const editProductDescriptionInput = document.getElementById('editProductDescription');
    const editProductPriceInput = document.getElementById('editProductPrice');
    let currentEditId = null;

 
    function renderproduk() {
        productListContainer.innerHTML = '';
        produk.forEach(product => {
            const productCard = document.createElement('div');
            productCard.classList.add('col', 'product-card');
            productCard.innerHTML = `
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">${product.nama_produk}</h5>
                        <p class="card-text">${product.deskripsi}</p>
                        <p class="card-price">${product.harga}</p>
                        ${product.image_url ? `<img src="${product.image_url}" alt="Product Image" width="50" height="50" class="ml-2" />` : ''}
                        <button class="btn btn-sm btn-success editBtn" data-id="${product.id_produk}">Edit</button>
                        <button class="btn btn-sm btn-danger deleteBtn" data-id="${product.id_produk}">Delete</button>
                    </div>
                </div>
            `;
            productListContainer.appendChild(productCard);
        });

       
       // Saat tombol Edit diklik
$('.editBtn').on('click', function () {
    currentEditId = $(this).data('id');
    const product = produk.find(p => p.id_produk === currentEditId);

    // Isi input form dengan data produk
    editProductNameInput.value = product.nama_produk;
    editProductDescriptionInput.value = product.deskripsi;
    editProductPriceInput.value = product.harga;

    // Tampilkan gambar produk saat ini jika ada
    const currentImage = document.getElementById('currentProductImage');
    if (product.image_url) {
        currentImage.src = product.image_url;
        currentImage.style.display = 'block';
    } else {
        currentImage.style.display = 'none';
    }

    // Reset input file
    $('#editProductImage').val('');
    editModal.show();
});

        $('.deleteBtn').on('click', function () {
            const id = $(this).data('id');
            $.ajax({
                url: '/produk/' + id,
                type: 'DELETE',
                success: function () {
                    produk = produk.filter(product => product.id_produk !== id);
                    renderproduk();
                }
            });
        });
    }

    
    $('#addProductModal').on('shown.bs.modal', function () {
        fileInputContainer.style.display = 'block'; 
        $('#newProductName').val(''); 
        $('#newProductDescription').val(''); 
        $('#newProductPrice').val(''); 
        $('#newProductImage').val(''); 
    });


    $('#addProductFormModal').on('submit', function (e) {
        e.preventDefault();
        const newProductName = $('#newProductName').val().trim();
        const newProductDescription = $('#newProductDescription').val().trim();
        const newProductPrice = $('#newProductPrice').val().trim();
        if (!newProductName || !newProductDescription || !newProductPrice) return;

        const image = $('#newProductImage')[0].files[0];
        const formData = new FormData();
        formData.append('nama_produk', newProductName);
        formData.append('deskripsi', newProductDescription);
        formData.append('harga', newProductPrice);
        if (image) formData.append('image', image);

        $.ajax({
            url: '/produk',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (newProduct) {
                produk.push(newProduct);
                renderproduk();
                $('#addProductModal').modal('hide');
                $('.modal-backdrop').remove(); 
                $('#addProductFormModal')[0].reset(); 
                fileInputContainer.style.display = 'none'; 
            },
            error: function (error) {
                console.error("Error adding product:", error.responseText);
            }
        });
    });

    
    $('#editProductForm').on('submit', function (e) {
        e.preventDefault();
    
        const updatedProductName = $('#editProductName').val().trim();
        const updatedProductDescription = $('#editProductDescription').val().trim();
        const updatedProductPrice = $('#editProductPrice').val().trim();
        const newImage = $('#editProductImage')[0].files[0];
    
        if (!updatedProductName || !updatedProductDescription || !updatedProductPrice) return;
    
        const formData = new FormData();
        formData.append('nama_produk', updatedProductName);
        formData.append('deskripsi', updatedProductDescription);
        formData.append('harga', updatedProductPrice);
        if (newImage) {
            formData.append('image', newImage);
        }
    
        $.ajax({
            url: '/produk/' + currentEditId,
            type: 'PUT',
            data: formData,
            processData: false,
            contentType: false,
            success: function (updatedProduct) {
                const product = produk.find(p => p.id_produk === currentEditId);
                product.nama_produk = updatedProduct.nama_produk;
                product.deskripsi = updatedProduct.deskripsi;
                product.harga = updatedProduct.harga;
    
                // Perbarui URL gambar jika ada gambar baru
                if (updatedProduct.image_url) {
                    product.image_url = updatedProduct.image_url;
                }
    
                renderproduk();
                editModal.hide();
                $('.modal-backdrop').remove();
            },
            error: function (error) {
                console.error("Error updating product:", error.responseText);
            }
        });
    });

   
    $(document).ready(function () {
        $.get('/produk', function (data) {
            produk = data;
            renderproduk();
        });
    });

    $('#addProductModal').on('hidden.bs.modal', function () {
        $('.modal-backdrop').remove(); 
        $('#newProductName').val('');
        $('#newProductDescription').val(''); 
        $('#newProductPrice').val(''); 
        $('#newProductImage').val(''); 
    });
</script>
